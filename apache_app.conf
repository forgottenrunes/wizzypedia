# Apache configuration for MediaWiki on Heroku
# This file limits concurrent connections to prevent database connection exhaustion

# AGGRESSIVE connection limits to prevent DB exhaustion
<IfModule mpm_prefork_module>
    StartServers            1
    MinSpareServers         1
    MaxSpareServers         2
    MaxRequestWorkers       5
    MaxConnectionsPerChild  50
</IfModule>

# Enable connection keep-alive but with reasonable limits
KeepAlive On
MaxKeepAliveRequests 50
KeepAliveTimeout 2

# Enable compression for better performance
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Set reasonable timeout values
Timeout 30

# Ensure proper handling of PHP
<FilesMatch \.php$>
    SetHandler application/x-httpd-php
</FilesMatch>

# Security headers
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "SAMEORIGIN"
Header set X-XSS-Protection "1; mode=block"
